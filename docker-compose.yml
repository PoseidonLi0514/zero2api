services:
  zero2api:
    build: .
    container_name: zero2api
    restart: unless-stopped
    environment:
      API_KEY: ${API_KEY}
      HOST: 0.0.0.0
      PORT: 8787
      # 可选：控制 JSON 请求体大小（base64 图片会很大）
      MAX_REQUEST_BODY_BYTES: ${MAX_REQUEST_BODY_BYTES:-20971520}
      # 默认已在代码写死；如未来变更可在这里覆盖
      # SUPABASE_ANON_KEY: ${SUPABASE_ANON_KEY}
    ports:
      - "${PORT:-8787}:8787"
    volumes:
      - ./data:/app/data
    healthcheck:
      test: ["CMD-SHELL", "node -e \"fetch('http://127.0.0.1:8787/healthz').then(r=>process.exit(r.ok?0:1)).catch(()=>process.exit(1))\""]
      interval: 10s
      timeout: 3s
      retries: 5
